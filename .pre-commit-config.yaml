repos:
  - repo: https://github.com/pre-commit/mirrors-mypy
    rev: v1.4.1
    hooks:
      - id: mypy
        additional_dependencies: [ types-PyYAML, types-PyMySQL ]
        entry: bash -c "mypy --ignore-missing-imports --cache-dir=/dev/null $( git status --porcelain=v1 | grep '.py' | grep -E 'A|M' | awk '{print $2}' | tr '\n' ' ')"
        pass_filenames: false
        always_run: true
  - repo: local
    hooks:
      - id: pytest
        name: pytest
        entry: pytest
        language: system
        pass_filenames: false
        always_run: true
      - id: update_coverage_badge
        name: update coverage badge
        entry: bash -c "pytest --cov=. --cov-report=term | grep TOTAL | awk '{print $4}' | sed 's/%//' | xargs -I {} sed -i 's/coverage-[0-9]*%/coverage-{}%/g' README.md"
        language: system
        pass_filenames: false
        always_run: true
